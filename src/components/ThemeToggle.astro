---
import IconSun from "./icons/IconSun.astro";
import IconMoon from "./icons/IconMoon.astro";
---

<button
  id="toggle-theme-btn"
  type="button"
  aria-label="Cambiar tema"
  aria-pressed="false"
  class="p-2 rounded-full border border-neutral-300 dark:border-neutral-600 bg-white dark:bg-neutral-900 hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-[var(--color-primary)] text-[var(--color-text)]"
>
  <div id="sun-icon" class="hidden">
    <IconSun class="w-8 h-8 text-yellow-400" />
  </div>
  <div id="moon-icon" class="hidden">
    <IconMoon />
  </div>
  <noscript>
    <IconSun />
  </noscript>
</button>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const root = document.documentElement;
    const btn = document.getElementById("toggle-theme-btn");
    const sun = document.getElementById("sun-icon");
    const moon = document.getElementById("moon-icon");
    const logo = document.getElementById("logo-img");

    const setUI = (isDark) => {
      sun.classList.toggle("hidden", isDark);
      moon.classList.toggle("hidden", !isDark);
      root.classList.toggle("dark", isDark);
      root.setAttribute("data-theme", isDark ? "dark" : "light");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      btn.setAttribute("aria-pressed", isDark.toString());

      if (logo) {
        logo.src = isDark
          ? "/assets/img/logo/edits/iabot-webp-09.webp"
          : "/assets/img/logo/edits/iabot-webp-06.webp";
      }
    };

    // LÃ³gica al iniciar
    const stored = localStorage.getItem("theme");
    const prefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)"
    ).matches;
    const initial = stored === "dark" || (!stored && prefersDark);
    setUI(initial);

    // Al hacer clic
    btn?.addEventListener("click", () => {
      const isNowDark = !root.classList.contains("dark");
      setUI(isNowDark);
    });
  });
</script>
